<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DocSift – AI-Powered Document Analysis</title>
  <meta
    name="description"
    content="Turn long work documents into clear summaries, key points, action items, and risk notes—fast."
  />
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Scoped styles for the auth section -->
  <style>
    .auth-section {
      margin-top: 3rem;
    }

    .auth-card {
      max-width: 520px;
      margin: 0 auto;
      background: #020617;
      border-radius: 16px;
      padding: 20px 20px 24px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.45);
      border: 1px solid #111827;
      color: #e5e7eb;
    }

    .auth-card h2 {
      margin: 0 0 4px;
      font-size: 1.35rem;
    }

    .auth-card p {
      margin: 0 0 16px;
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .auth-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .auth-tab-btn {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      padding: 6px 10px;
      font-size: 0.85rem;
      color: #9ca3af;
      cursor: pointer;
    }

    .auth-tab-btn.active {
      background: #2563eb;
      border-color: #2563eb;
      color: #ffffff;
    }

    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
    }

    .auth-form label {
      font-size: 0.85rem;
      color: #e5e7eb;
    }

    .auth-form input[type="email"],
    .auth-form input[type="password"] {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.9rem;
    }

    .auth-form input::placeholder {
      color: #6b7280;
    }

    .auth-btn-primary {
      margin-top: 4px;
      padding: 8px 10px;
      border-radius: 999px;
      border: none;
      background: #22c55e;
      color: #022c22;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .auth-btn-primary:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .auth-btn-link {
      padding: 4px 0;
      border: none;
      background: transparent;
      color: #60a5fa;
      font-size: 0.8rem;
      cursor: pointer;
      text-decoration: underline;
    }

    .auth-helper {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .auth-error {
      margin-top: 8px;
      font-size: 0.8rem;
      color: #f97373;
      display: none;
    }

    .auth-success {
      margin-top: 8px;
      font-size: 0.8rem;
      color: #4ade80;
      display: none;
    }

    .auth-status {
      margin-top: 12px;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: #030712;
      font-size: 0.8rem;
      display: none;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .auth-status span {
      color: #9ca3af;
    }

    .auth-status strong {
      color: #e5e7eb;
    }

        .auth-status button {
      border: none;
      background: transparent;
      color: #fca5a5;
      font-size: 0.8rem;
      cursor: pointer;
      text-decoration: underline;
      padding: 0;
    }

    .plan-status {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 4px;
    }

.auth-toggle {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 0.8rem;
  color: #9ca3af;
  margin-top: -4px;
  margin-bottom: 4px;
}


.auth-toggle input {
  accent-color: #22c55e;
}


    @media (max-width: 640px) {
      .auth-card {
        padding: 16px 14px 20px;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="logo">DocSift</div>
      <nav class="nav">
        <a href="#features">Features</a>
        <a href="#how-it-works">How it works</a>
        <a href="#pricing">Pricing</a>
        <a href="#account">Account</a>
        <a href="#faq">FAQ</a>
        <a
  href="https://docsift.streamlit.app"
  class="nav-cta open-app-link"
  target="_blank"
  rel="noopener"
>
  Open App
</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero">
      <div class="container hero-grid">
        <div class="hero-text">
          <h1>Turn long work documents into clear summaries and action items.</h1>
          <p class="hero-subtitle">
            DocSift helps busy professionals quickly extract what matters from reports, proposals, policies,
            and internal docs—without rewriting prompts every time.
          </p>

          <div class="hero-buttons">
            <a
  href="https://docsift.streamlit.app"
  class="btn primary open-app-link"
  target="_blank"
  rel="noopener"
>
  Use DocSift Free
</a>
            <a
  href="https://fishtexter.gumroad.com/l/docsift"
  class="btn ghost"
>
  Get DocSift Pro →
</a>

          </div>

          <p class="hero-note">
            No login required. Free tier available. Upgrade to Pro when you're ready.
          </p>
        </div>

        <div class="hero-panel">
          <div class="hero-card">
            <div class="hero-card-header">
              <span class="badge">Live Preview</span>
              <h2>Drop in a document. Get a one-minute brief.</h2>
            </div>
            <ul class="hero-list">
              <li>✅ Executive summary you can trust</li>
              <li>✅ Key points and decisions pulled out</li>
              <li>✅ Action items and next steps</li>
              <li>✅ Risks, gaps, and red flags</li>
              <li>✅ Clear rewrite for sharing with others</li>
            </ul>
            <p class="hero-card-footer">
              Built with OpenAI under the hood. You stay in control of what you upload.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- FEATURES -->
    <section id="features" class="section">
      <div class="container">
        <h2>Built for document-heavy work</h2>
        <p class="section-subtitle">
          Use DocSift when you’re buried in PDFs and need clarity fast—before the next meeting, email, or decision.
        </p>

        <div class="feature-grid">
          <div class="feature-card">
            <h3>Executive Summaries</h3>
            <p>
              Get a clean, accurate summary you can paste into an email, meeting notes, or a decision brief.
            </p>
          </div>

          <div class="feature-card">
            <h3>Key points and next steps</h3>
            <p>
              Pull out the core takeaways plus actionable next steps for your team.
            </p>
          </div>

          <div class="feature-card">
            <h3>Risks and red flags</h3>
            <p>
              Spot gaps, vague language, and potential problems faster—great for policies, vendor docs, and contracts.
            </p>
          </div>

          <div class="feature-card">
            <h3>Simplify the jargon</h3>
            <p>
              Turn complex language into something you can explain to anyone on your team (or leadership).
            </p>
          </div>

          <div class="feature-card">
            <h3>Rewrite for clarity</h3>
            <p>
              Improve tone and readability while preserving meaning—perfect for sharing updates or summaries.
            </p>
          </div>

          <div class="feature-card">
            <h3>One-page brief</h3>
            <p>
              Create a structured brief you can copy into your docs and share with stakeholders.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- HOW IT WORKS -->
    <section id="how-it-works" class="section alt">
      <div class="container">
        <h2>How it works</h2>
        <div class="steps-grid">
          <div class="step">
            <div class="step-number">1</div>
            <h3>Upload your document</h3>
            <p>
              Drop in a PDF, Word file, or text. DocSift extracts the text and checks basic limits so
              you don't accidentally send a whole book.
            </p>
          </div>

          <div class="step">
            <div class="step-number">2</div>
            <h3>Pick what you need</h3>
            <p>
              Use tabs to generate summaries, key points, action items, risks, explanations, rewrites,
              study guides, or a full report.
            </p>
          </div>

          <div class="step">
            <div class="step-number">3</div>
            <h3>Copy & share</h3>
            <p>
              Copy the output into email, Slack, tickets, or your docs. Use it to align your team and move faster.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- PRICING -->
    <section id="pricing" class="section">
      <div class="container">
        <h2>Simple pricing</h2>
        <p class="section-subtitle">
          Start free. Upgrade to Pro when DocSift proves its value in your workflow.
        </p>

        <div class="pricing-grid">
          <div class="pricing-card">
            <h3>Free</h3>
            <p class="price">$0</p>
            <ul>
              <li>Limited pages per document</li>
              <li>Summaries & basic analysis</li>
              <li>No account required</li>
            </ul>
            <a
  href="https://docsift.streamlit.app"
  class="btn secondary full open-app-link"
  target="_blank"
  rel="noopener"
>
  Use DocSift Free
</a>
          </div>

          <div class="pricing-card pro">
            <div class="badge">Most Popular</div>
            <h3>DocSift Pro</h3>
            <p class="price">$9 / month</p>
            <ul>
              <li>Up to 30 pages per document</li>
              <li>All tools unlocked (Key Points, Action Items, Risks, Rewrites, Study Guides, Full Report)</li>
              <li>Higher limits for real workflows</li>              
            </ul>
            <a
  href="https://fishtexter.gumroad.com/l/docsift"
  class="btn primary full"
>
  Get DocSift Pro
</a>

          </div>
        </div>
      </div>
    </section>

    <!-- PRO ACTIVATION -->
<section id="pro-activation" class="section alt">
  <div class="container">
    <h2>How DocSift Pro activates</h2>
    <p class="section-subtitle">
      DocSift Pro activates automatically after checkout. No activation codes, and nothing to paste into the app.
      Here’s exactly how it works:
    </p>

    <div class="steps-grid">
      <div class="step">
        <div class="step-number">1</div>
        <h3>Purchase DocSift Pro</h3>
        <p>
          Click any <strong>Get DocSift Pro</strong> button on this page to go to our Gumroad product page and click Subscribe to checkout.
          Complete your purchase using your preferred payment method.
        </p>
      </div>

      <div class="step">
        <div class="step-number">2</div>
        <h3>Automatic account upgrade</h3>
        <p>
          After checkout, Gumroad notifies DocSift instantly. Your account is upgraded to Pro
          <strong>automatically</strong>—no codes, no manual steps.
        </p>
      </div>

      <div class="step">
        <div class="step-number">3</div>
        <h3>Open the DocSift app</h3>
        <p>
          Click <strong>Open App</strong> at the top of this site (or go to <strong>docsift.streamlit.app</strong>)
          while logged in with the same email (important!) you used at checkout. The app will detect your Pro status immediately.
        </p>
      </div>

      <div class="step">
        <div class="step-number">4</div>
        <h3>Enjoy Pro features instantly</h3>
        <p>
              When Pro is active, the sidebar will show <strong>⭐ DocSift Pro</strong>, and all Pro-only tools unlock
              automatically.
            </p>
      </div>
    </div>

    <p class="section-subtitle" style="margin-top: 1.8rem;">
      If your Pro status doesn’t appear after checkout, just contact
      <a href="mailto:support@getdocsift.com">support@getdocsift.com</a> and we'll help right away.
    </p>
  </div>
</section>


    <!-- ACCOUNT / AUTH SECTION -->
    <section id="account" class="section alt auth-section">
      <div class="container">
        <h2>DocSift account (email login)</h2>
        <p class="section-subtitle">
          Use your email and password to create an account or sign in. This account
          will connect directly to your DocSift Pro subscription and usage after purchase.
        </p>

        <div class="auth-card" id="auth-card">
          <h2>Sign in or create an account</h2>
          <p>Use your email and a password you’ll remember. You can reset it at any time.</p>

          <div class="auth-tabs">
            <button type="button" class="auth-tab-btn active" id="tab-login">Log in</button>
            <button type="button" class="auth-tab-btn" id="tab-signup">Create account</button>
            <button type="button" class="auth-tab-btn" id="tab-reset">Reset password</button>
          </div>

          <div id="auth-forms">
            <!-- LOGIN FORM -->
            <!-- LOGIN FORM -->
<form id="login-form" class="auth-form">
  <label for="login-email">Email</label>
  <input
    id="login-email"
    type="email"
    placeholder="you@example.com"
    required
  />

  <label for="login-password">Password</label>
  <input
    id="login-password"
    type="password"
    placeholder="••••••••"
    required
  />

  <label class="auth-toggle">
    <input type="checkbox" id="login-show-password" />
    <span>Show password</span>
  </label>

  <button
    type="submit"
    class="auth-btn-primary"
    id="login-submit"
  >
    Log in
  </button>

  <button
    type="button"
    class="auth-btn-link"
    id="login-to-signup"
  >
    Need an account? Create one
  </button>

  <button
    type="button"
    class="auth-btn-link"
    id="login-to-reset"
  >
    Forgot your password?
  </button>
</form>



            <!-- SIGNUP FORM -->
            <!-- SIGNUP FORM -->
<form id="signup-form" class="auth-form" style="display:none;">
  <label for="signup-email">Email</label>
  <input
    id="signup-email"
    type="email"
    placeholder="you@example.com"
    required
  />

  <label for="signup-password">Password</label>
  <input
    id="signup-password"
    type="password"
    placeholder="At least 6 characters"
    required
  />

  <label class="auth-toggle">
    <input type="checkbox" id="signup-show-password" />
    <span>Show password</span>
  </label>

  <button
    type="submit"
    class="auth-btn-primary"
    id="signup-submit"
  >
    Create account
  </button>

  <button
    type="button"
    class="auth-btn-link"
    id="signup-to-login"
  >
    Already have an account? Log in
  </button>
</form>




            <!-- RESET PASSWORD FORM -->
            <form id="reset-form" class="auth-form" style="display:none;">
              <label for="reset-email">Email</label>
              <input id="reset-email" type="email" placeholder="you@example.com" required />

              <button type="submit" class="auth-btn-primary" id="reset-submit">Send reset link</button>
              <p class="auth-helper">
                We'll email you a password reset link if there's an account for this address.
              </p>
              <button type="button" class="auth-btn-link" id="reset-to-login">
                Back to log in
              </button>
            </form>
          </div>

          <div id="auth-error" class="auth-error"></div>
          <div id="auth-success" class="auth-success"></div>

          <div id="auth-status" class="auth-status">
  		<div>
    			<span>Status:</span>
    			<strong id="auth-status-text">Not signed in</strong>
    			<div id="plan-status" class="plan-status"></div>
  		</div>
  		<button type="button" id="logout-button">Log out</button>
	  </div>

        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="section alt">
      <div class="container">
        <h2>FAQ</h2>
        <div class="faq-grid">
          <div class="faq-item">
            <h3>Do I need an account to try DocSift?</h3>
            <p>
              No. You can use the free version directly in your browser without creating an account.
            </p>
          </div>

          <div class="faq-item">
            <h3>What types of files are supported?</h3>
            <p>
              Right now DocSift supports PDF, Word (.docx), and plain text (.txt) files, with safety
              limits to prevent huge uploads.
            </p>
          </div>

          <div class="faq-item">
            <h3>Is there a limit on document size?</h3>
            <p>
              Yes, there are different page limits for Free and Pro. The
              app will tell you if a file is too large.
            </p>
          </div>

          <div class="faq-item">
            <h3>Can I cancel Pro?</h3>
            <p>
              Yes. You control your subscription in Gumroad. Cancel any time and keep using the free
              version.
            </p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div class="footer-left">
        <div class="logo">DocSift</div>
        <p>AI-powered document analysis toolkit.</p>
      </div>
      <div class="footer-right">
        <a
  href="https://docsift.streamlit.app"
  class="open-app-link"
  target="_blank"
  rel="noopener"
>
  Open App
</a>
        <a href="mailto:support@getdocsift.com">Contact</a>
      </div>
    </div>
  </footer>

  <!-- Firebase Auth + UI logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import {
  getAuth,
  onAuthStateChanged,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  sendPasswordResetEmail,
  signOut
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import {
  getFirestore,
  doc,
  setDoc,
  serverTimestamp,
  getDoc
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    // Your Firebase configuration  
    const firebaseConfig = {
      apiKey: "AIzaSyCEWuC6JRAQ1pJRR85aFVPIkrb8oARnQjE",
      authDomain: "docsift-prod.firebaseapp.com",
      projectId: "docsift-prod",
      storageBucket: "docsift-prod.firebasestorage.app",
      messagingSenderId: "329761785362",
      appId: "1:329761785362:web:286a596f5036b5ac963acb",
      measurementId: "G-M6JL3DMG6B"  // not used, but OK to keep
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    

    // DOM elements
    const tabLogin = document.getElementById("tab-login");
    const tabSignup = document.getElementById("tab-signup");
    const tabReset = document.getElementById("tab-reset");

    const loginForm = document.getElementById("login-form");
    const signupForm = document.getElementById("signup-form");
    const resetForm = document.getElementById("reset-form");

    const loginToSignup = document.getElementById("login-to-signup");
    const loginToReset = document.getElementById("login-to-reset");
    const signupToLogin = document.getElementById("signup-to-login");
    const resetToLogin = document.getElementById("reset-to-login");

    const authError = document.getElementById("auth-error");
    const authSuccess = document.getElementById("auth-success");
    const authStatus = document.getElementById("auth-status");
    const authStatusText = document.getElementById("auth-status-text");
    const planStatus = document.getElementById("plan-status");
    const logoutButton = document.getElementById("logout-button");
    const authForms = document.getElementById("auth-forms");

    const loginSubmit = document.getElementById("login-submit");
    const signupSubmit = document.getElementById("signup-submit");
    const resetSubmit = document.getElementById("reset-submit");

    const loginShowPassword = document.getElementById("login-show-password");
    const signupShowPassword = document.getElementById("signup-show-password");


    function setActiveTab(tab) {
      // buttons
      tabLogin.classList.remove("active");
      tabSignup.classList.remove("active");
      tabReset.classList.remove("active");

      if (tab === "login") tabLogin.classList.add("active");
      if (tab === "signup") tabSignup.classList.add("active");
      if (tab === "reset") tabReset.classList.add("active");

      // forms
      loginForm.style.display = tab === "login" ? "flex" : "none";
      signupForm.style.display = tab === "signup" ? "flex" : "none";
      resetForm.style.display = tab === "reset" ? "flex" : "none";

      // messages
      authError.style.display = "none";
      authSuccess.style.display = "none";
    }

    function showError(msg) {
      if (!msg) {
        authError.style.display = "none";
        return;
      }
      authError.textContent = msg;
      authError.style.display = "block";
      authSuccess.style.display = "none";
    }

    function showSuccess(msg) {
      if (!msg) {
        authSuccess.style.display = "none";
        return;
      }
      authSuccess.textContent = msg;
      authSuccess.style.display = "block";
      authError.style.display = "none";
    }

    // Tab handlers
    tabLogin?.addEventListener("click", () => setActiveTab("login"));
    tabSignup?.addEventListener("click", () => setActiveTab("signup"));
    tabReset?.addEventListener("click", () => setActiveTab("reset"));

    loginToSignup?.addEventListener("click", () => setActiveTab("signup"));
    loginToReset?.addEventListener("click", () => setActiveTab("reset"));
    signupToLogin?.addEventListener("click", () => setActiveTab("login"));
    resetToLogin?.addEventListener("click", () => setActiveTab("login"));

    // Default tab
    setActiveTab("login");

loginShowPassword?.addEventListener("change", (e) => {
  const input = document.getElementById("login-password");
  if (input) {
    input.type = e.target.checked ? "text" : "password";
  }
});

signupShowPassword?.addEventListener("change", (e) => {
  const input = document.getElementById("signup-password");
  if (input) {
    input.type = e.target.checked ? "text" : "password";
  }
});

    // LOGIN
    loginForm?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("login-email").value.trim();
      const password = document.getElementById("login-password").value;

      loginSubmit.disabled = true;
      showError("");
      showSuccess("");

      try {
        await signInWithEmailAndPassword(auth, email, password);
        // onAuthStateChanged will handle UI update
      } catch (err) {
        console.error(err);
        showError("Login failed. Please check your email and password.");
      } finally {
        loginSubmit.disabled = false;
      }
    });

    // SIGNUP
signupForm?.addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("signup-email").value.trim();
  const password = document.getElementById("signup-password").value;

  signupSubmit.disabled = true;
  showError("");
  showSuccess("");

  try {
    const cred = await createUserWithEmailAndPassword(auth, email, password);
const user = cred.user;
const emailKey = (user.email || email).toLowerCase();

// Create or merge Firestore user doc keyed by email
const userRef = doc(db, "users", emailKey);
await setDoc(
  userRef,
  {
    email: emailKey,
    uid: user.uid,
    plan: "free",           // default plan
    createdAt: serverTimestamp(),
    proSince: null,
  },
  { merge: true } // don’t overwrite if webhook already created Pro
);




    showSuccess("Account created and you are now signed in.");
    setActiveTab("login");
  } catch (err) {
    console.error(err);
    let msg = "Could not create account. Please try again.";

    if (err.code === "auth/email-already-in-use") {
      msg = "That email is already in use. Try logging in instead.";
    } else if (err.code === "auth/weak-password") {
      msg = "Password is too weak. Use at least 6 characters.";
    } else if (err.code === "auth/invalid-email") {
      msg = "That email address doesn’t look valid.";
    } else if (err.code === "auth/operation-not-allowed") {
      msg = "Email/password sign-in is not enabled in the project.";
    } else if (err.code === "auth/unauthorized-domain") {
      msg = "This domain is not allowed to use this sign-in method.";
    }

    showError(msg);
  } finally {
    signupSubmit.disabled = false;
  }
});

    // RESET PASSWORD
    resetForm?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("reset-email").value.trim();

      resetSubmit.disabled = true;
      showError("");
      showSuccess("");

      try {
        await sendPasswordResetEmail(auth, email);
        showSuccess("If an account exists for that email, a reset link has been sent.");
      } catch (err) {
        console.error(err);
        showError("Could not send reset link. Please try again later.");
      } finally {
        resetSubmit.disabled = false;
      }
    });

    // LOG OUT
    logoutButton?.addEventListener("click", async () => {
      try {
        await signOut(auth);
      } catch (err) {
        console.error(err);
      }
    });

// OPTIONAL: Create Firestore doc if missing (for old accounts)
async function ensureUserDoc(user) {
  const emailKey = (user.email || "").toLowerCase();
  if (!emailKey) return;

  const userRef = doc(db, "users", emailKey);
  const snap = await getDoc(userRef);

  if (!snap.exists()) {
    await setDoc(userRef, {
      email: emailKey,
      uid: user.uid || null,
      plan: "free",
      createdAt: serverTimestamp(),
      proSince: null,
    });
  } else {
    // Make sure uid is stored if missing
    await setDoc(
      userRef,
      { uid: user.uid || null },
      { merge: true }
    );
  }
}



// ---- END OF HELPER ----


        // AUTH STATE LISTENER
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        // Show status UI and hide forms
        authStatus.style.display = "flex";
        authStatusText.textContent = `Signed in as ${user.email || "(no email)"}`;
        logoutButton.style.display = "inline";
        authForms.style.display = "block"; // keep forms visible container, tabs, etc., if you prefer; or "none" to hide them
        if (planStatus) {
          planStatus.textContent = "Loading plan…";
        }

        try {
          // Make sure the Firestore user doc exists for older accounts
          await ensureUserDoc(user);

          // Now read the user document to get the plan
          const emailKey = (user.email || "").toLowerCase();
let plan = "free";

if (emailKey) {
  const userRef = doc(db, "users", emailKey);
  const snap = await getDoc(userRef);

  if (snap.exists()) {
    const data = snap.data();
    plan = data.plan || "free";
  }
}


          if (planStatus) {
            planStatus.textContent = plan === "pro" ? "Pro plan" : "Free plan";
          }
        } catch (err) {
          console.error("Error loading user plan:", err);
          if (planStatus) {
            planStatus.textContent = "Free plan";
          }
        }
      } else {
        // Not signed in
        authStatus.style.display = "flex";
        authStatusText.textContent = "Not signed in";
        logoutButton.style.display = "none";
        authForms.style.display = "block";
        if (planStatus) {
          planStatus.textContent = "";
        }
      }
    });

    // ---------- Open App links: pass Firebase ID token to Streamlit ----------

    const STREAMLIT_APP_BASE_URL = "https://docsift.streamlit.app";

    async function handleOpenAppClick(event) {
      event.preventDefault();

      const user = auth.currentUser;

      // If no logged-in user, just open the app without a token (anonymous free use)
      if (!user) {
        window.open(STREAMLIT_APP_BASE_URL, "_blank");
        return;
      }

      try {
        const idToken = await user.getIdToken();
        const url = `${STREAMLIT_APP_BASE_URL}/?token=${encodeURIComponent(idToken)}`;
        window.open(url, "_blank");
      } catch (err) {
        console.error("Error getting ID token for Open App:", err);
        // Fallback: open app without token
        window.open(STREAMLIT_APP_BASE_URL, "_blank");
      }
    }

    // Attach click handler to all links with class "open-app-link"
    document.querySelectorAll(".open-app-link").forEach((link) => {
      link.addEventListener("click", handleOpenAppClick);
    });

 
  </script>
</body>
</html>
